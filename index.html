<!DOCTYPE html>
<html>
<head>
  <title>Video Downloader</title>
</head>
<body>
  <h1>YouTube Downloader</h1>
  <input type="text" id="urlInput" placeholder="Paste YouTube URL" />
  <button onclick="fetchInfo()">Get Formats</button>
  <div id="output"></div>

  <script>
    async function fetchInfo() {
      const url = document.getElementById("urlInput").value;
      const response = await fetch("https://your-repl-name.repl.co/extract", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ url })
      });

      const data = await response.json();
      const output = document.getElementById("output");

      if (data.error) {
        output.innerHTML = `âŒ Error: ${data.error}`;
        return;
      }

      const video = data.formats.filter(f => f.vcodec !== 'none' && f.acodec === 'none').sort((a, b) => b.height - a.height)[0];
      const audio = data.formats.filter(f => f.acodec !== 'none' && f.vcodec === 'none').sort((a, b) => b.abr - a.abr)[0];

      output.innerHTML = `
        <h3>${data.title}</h3>
        <img src="${data.thumbnail}" width="200" /><br>
        <button onclick="download('${video.url}', '${audio.url}', '${data.title}')">Download Best Quality</button>
      `;
    }

    async function download(videoUrl, audioUrl, title) {
      // Load ffmpeg.wasm
      const { createFFmpeg, fetchFile } = FFmpeg;
      const ffmpeg = createFFmpeg({ log: true });

      await ffmpeg.load();

      ffmpeg.FS('writeFile', 'video.mp4', await fetchFile(videoUrl));
      ffmpeg.FS('writeFile', 'audio.mp3', await fetchFile(audioUrl));

      await ffmpeg.run('-i', 'video.mp4', '-i', 'audio.mp3', '-c:v', 'copy', '-c:a', 'aac', 'output.mp4');

      const data = ffmpeg.FS('readFile', 'output.mp4');
      const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));
      const a = document.createElement('a');
      a.href = url;
      a.download = `${title}.mp4`;
      a.click();
    }
  </script>

  <!-- Load ffmpeg.wasm from CDN -->
  <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.js"></script>
</body>
</html>
